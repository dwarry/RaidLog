var rvm=require("./riskDetails"),dataService=require("./services/dataService"),pg=require("./pagedGrid"),riskList=function(){function n(){var n=this,t;this.projectCode=ko.observable(""),this.projectName=ko.observable(""),this.hideClosedItems=ko.observable(!0),this.risks=ko.observableArray([]),this.approaches=ko.observableArray(),this.impacts=ko.observableArray(),this.likelihoods=ko.observableArray(),this.rifCategories=ko.observableArray(),t={data:this.risks,pageSize:12},this._mappingOptions={key:function(n){return n.id},create:function(t){return new rvm(t.data,n.projectId,function(t){n.listViewModel.allData.push(t)})}},this.listViewModel=new pg.ListViewModel(t),this.listViewModel.filteredData=ko.computed(function(){var t=n.listViewModel.searchField().trim();return!n.listViewModel.searchPredicate||t.length===0?ko.utils.unwrapObservable(n.listViewModel.allData):ko.utils.arrayFilter(ko.utils.unwrapObservable(n.listViewModel.allData),function(i){return n.hideClosedItems()&&!i.isActive()?!1:n.listViewModel.searchPredicate(t,i)})},this),this.listViewModel.searchPredicate=function(n,t){var i=t.description();return i&&i.indexOf(n)!==-1}}return n.prototype.search=function(n){this.listViewModel.searchField(n)},n.prototype.activate=function(n){var t=this;this.projectId=n;var i=dataService.getReferenceData().done(function(n){t.approaches(n.approaches),t.impacts(n.impacts),t.likelihoods(n.likelihoods),t.rifCategories(n.rifCategories)}),r=dataService.getProject(this.projectId).done(function(n){t.projectId=n.id,t.projectCode(n.code),t.projectName(n.name)}),u=this.refresh();return $.when([i,r,u])},n.prototype.refresh=function(){var n=this;return dataService.getProjectRisks(this.projectId).done(function(t){ko.mapping.fromJS(t,n._mappingOptions,n.risks)})},n.prototype.newRisk=function(){this.listViewModel.selected(ko.mapping.fromJS(dataService.makeRiskDto(),this._mappingOptions))},n}();module.exports=riskList