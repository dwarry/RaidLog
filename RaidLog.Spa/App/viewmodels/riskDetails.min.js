define(["require","exports","services/dataService"],function(n,t,i){function f(n){var t=0;return $.each(r.impacts,function(i,r){return r.id===n?(t=r.score,!1):!0}),t}function e(n){var t=0;return $.each(r.likelihoods,function(i,r){return r.id===n?(t=r.score,!1):!0}),t}var u=i,r;return u.getReferenceData().done(function(n){r=n}),function(){function n(n,t,i){var r=this;this.projectId=t,this.newItemCallback=i,this.riskNumber=ko.observable(0),this.description=ko.observable("").extend({required:!0,maxLength:2048}),this.raisedDate=ko.observable(moment().local().format("YYYY-MM-DD")).extend({required:!0,dateISO:!0}),this.raisedBy=ko.observable("").extend({required:!0,maxLength:50}),this.rifCategoryId=ko.observable().extend({required:!0}),this.isProjectRisk=ko.observable(!0),this.workstream=ko.observable("").extend({required:!0,maxLength:50}),this.commentary=ko.observable("").extend({maxLength:2048}),this.approachId=ko.observable(null).extend({required:!0}),this.impactId=ko.observable(null).extend({required:!0}),this.likelihoodId=ko.observable(null).extend({required:!0}),this.owner=ko.observable("").extend({maxLength:50}),this.isActive=ko.observable(!0),this.score=ko.computed(function(){return f(r.impactId())*e(r.likelihoodId())},this),this.rag=ko.computed(function(){var n=r.score();return n<=5?"ragGreen":n>=15?"ragRed":"ragAmber"}),this.validation=ko.validatedObservable([this.riskNumber,this.description,this.raisedDate,this.raisedBy,this.rifCategoryId,this.isProjectRisk,this.workstream,this.commentary,this.approachId,this.impactId,this.likelihoodId,this.owner,this.isActive]),this.updateFromItem(n),this.canSave=ko.computed(function(){return r.validation.isValid()},this),this.canDelete=ko.computed(function(){return r.id!==0})}return n.prototype.updateFromItem=function(n){n==null?(this.id=0,this.version="",this.riskNumber(null),this.description(""),this.raisedDate(moment().format("YYYY-MM-DD")),this.raisedBy(""),this.rifCategoryId(null),this.isProjectRisk(!0),this.workstream(""),this.commentary(""),this.approachId(null),this.impactId(null),this.likelihoodId(null),this.owner("")):(this.id=n.id,this.version=n.version,this.riskNumber(n.riskNumber),this.description(n.description),this.raisedDate(n.raisedDate.substring(0,10)),this.raisedBy(n.raisedBy),this.rifCategoryId(n.rifCategoryId),this.isProjectRisk(n.isProjectRisk),this.workstream(n.workstream),this.commentary(n.commentary),this.approachId(n.approachId),this.impactId(n.impactId),this.likelihoodId(n.likelihoodId),this.owner(n.owner))},n.prototype.saveItem=function(){var n=this,t={description:this.description(),raisedDate:this.raisedDate(),raisedBy:this.raisedBy(),rifCategoryId:this.rifCategoryId(),isProjectRisk:this.isProjectRisk(),workstream:this.workstream(),commentary:this.commentary(),approachId:this.approachId(),impactId:this.impactId(),likelihoodId:this.likelihoodId(),owner:this.owner()},i=this.isNewItem();return i||(t.id=this.id,t.version=this.version),u.saveRisk(this.projectId,t).done(function(t){n.updateFromItem(t),i&&n.newItemCallback(n)})},n}()})