var dataService=require("./services/dataService"),routeFactory=require("./services/routeFactory"),router=require("plugins/router"),pg=require("./viewmodels/pagedGrid"),maintainProject=require("./viewmodels/maintainProject"),projectList=function(){function n(){this.title="Projects",this.projects=ko.observableArray();var n={data:this.projects};this.listViewModel=new pg.ListViewModel(n),this.listViewModel.searchPredicate=function(n,t){return t.code.indexOf(n)!==-1||t.name.indexOf(n)!==-1},this.canEditProject=this.canArchiveProject=ko.computed(function(){return this.listViewModel.selected()!==null},this)}return n.prototype.search=function(n){this.listViewModel.searchField(n)},n.prototype.activate=function(){this.refresh()},n.prototype.refresh=function(){var n=this;dataService.getProjects().done(function(t){$.each(t,function(n,t){t.projectRisksLink=routeFactory.makeProjectRiskLink(t.id),t.projectAssumptionsLink=routeFactory.makeProjectAssumptionLink(t.id),t.projectIssuesLink=routeFactory.makeProjectIssueLink(t.id),t.projectDependenciesLink=routeFactory.makeProjectDependencyLink(t.id),t.projectQueriesLink=routeFactory.makeProjectQueryLink(t.id)}),n.projects(t),n.listViewModel.setSelected(null)})},n.prototype.editProject=function(){var n=this,t=new maintainProject(this.listViewModel.selected());t.show().done(function(t){t&&n.refresh()})},n.prototype.newProject=function(){var n=this,t=new maintainProject(null);t.show().done(function(t){t&&n.refresh()})},n.prototype.archiveProject=function(){},n.prototype.viewRisks=function(n){router.navigate(n.projectRisksLink)},n}();module.exports=projectList