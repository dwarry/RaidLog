define(["require","exports","./RiskViewModel","services/dataService","./pagedGrid"],function(n,t,i,r,u){var e=i,f=r,o=u,s=function(){function n(){var t=this,n;this.projectCode=ko.observable(""),this.projectName=ko.observable(""),this.activeItems=ko.observable(!0),this.risks=ko.observableArray(),this.approaches=ko.observableArray(),this.impacts=ko.observableArray(),this.likelihoods=ko.observableArray(),this.rifCategories=ko.observableArray(),n={data:this.risks},this._mappingOptions={key:function(n){return n.id},create:function(n){return new e.RiskViewModel(n.data,function(n){t.listViewModel.allData.push(n)})}},this.listViewModel=new o.ListViewModel(n),this.listViewModel.searchPredicate=function(n,t){return t.description.indexOf(n)!==-1}}return n.prototype.search=function(n){this.listViewModel.searchField(n)},n.prototype.activate=function(n,t){var i=this;this.projectId=n,this.activeItems(t);var r=f.getReferenceData().done(function(n){i.approaches(n.approaches),i.impacts(n.impacts),i.likelihoods(n.likelihoods),i.rifCategories(n.rifCategories)}),u=f.getProject(this.projectId).done(function(n){i.projectId=n.id,i.projectCode(n.code),i.projectName(n.name)}),e=this.refresh();return $.when([r,u,e])},n.prototype.refresh=function(){var n=this;return f.getProjectRisks(this.projectId,this.activeItems()).done(function(t){return ko.mapping.fromJS(n.risks(t),n._mappingOptions)})},n}()})